/* @preserve
* @esri/arcgis-rest-feature-service-admin - v1.13.0 - Apache-2.0
* Copyright (c) 2017-2018 Esri, Inc.
* Tue Oct 09 2018 07:54:53 GMT-0700 (PDT)
*/
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@esri/arcgis-rest-request'), require('@esri/arcgis-rest-items')) :
	typeof define === 'function' && define.amd ? define(['exports', '@esri/arcgis-rest-request', '@esri/arcgis-rest-items'], factory) :
	(factory((global.arcgisRest = global.arcgisRest || {}),global.arcgisRest,global.arcgisRest));
}(this, (function (exports,arcgisRestRequest,arcgisRestItems) { 'use strict';

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */



var __assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }
    return t;
};

/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.
 * Apache-2.0 */
/**
 * Create a new hosted feature service.
 *
 * ```js
 * import { createFeatureService } from '@esri/arcgis-rest-feature-service-admin';
 *
 * createFeatureService({
 *   authentication: userSession,
 *   item: {
 *     "name": "NewEmptyService",
 *     "capabilities": "Create,Delete,Query,Update,Editing"
 *   }
 * });
 * ```
 *
 * @param requestOptions - Options for the request
 * @returns A Promise that resolves with service details once the service has been created
 */
function createFeatureService(requestOptions) {
    var owner = arcgisRestItems.determineOwner(requestOptions);
    var baseUrl = arcgisRestRequest.getPortalUrl(requestOptions) + "/content/users/" + owner;
    var url = baseUrl + "/createService";
    // Create the service
    requestOptions.params = __assign({ createParameters: requestOptions.item, outputType: "featureService" }, requestOptions.params);
    if (!requestOptions.folderId || requestOptions.folderId === "/") {
        // If the service is destined for the root folder, just send the request and return the promise;
        // services are created in the root folder
        return arcgisRestRequest.request(url, requestOptions);
    }
    else {
        // If the service is destined for a subfolder, catch the results of the request and then move
        // the item to the desired folder
        return new Promise(function (resolve, reject) {
            arcgisRestRequest.request(url, requestOptions).then(function (createResults) {
                if (createResults.success) {
                    arcgisRestItems.moveItem({
                        itemId: createResults.itemId,
                        folderId: requestOptions.folderId,
                        authentication: requestOptions.authentication
                    }).then(function (moveResults) {
                        if (moveResults.success) {
                            resolve(createResults);
                        }
                        else {
                            reject({ success: false });
                        }
                    });
                }
                else {
                    reject({ success: false });
                }
            });
        });
    }
}

/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.
 * Apache-2.0 */
/**
 * Add layer(s) and/or table(s) to a hosted feature service.
 *
 * ```js
 * import { addToServiceDefinition } from '@esri/arcgis-rest-feature-service-admin';
 *
 * addToServiceDefinition(serviceurl, {
 *   authentication: userSession,
 *   layers: [],
 *   tables: []
 * });
 * ```
 *
 * @param url - URL of feature service
 * @param requestOptions - Options for the request
 * @returns A Promise that resolves with service layer and/or table details once the definition
 * has been updated
 */
function addToServiceDefinition(url, requestOptions) {
    var adminUrl = url.replace("/rest/services", "/rest/admin/services") + "/addToDefinition";
    requestOptions.params = __assign({ addToDefinition: {} }, requestOptions.params);
    if (requestOptions.layers && requestOptions.layers.length > 0) {
        requestOptions.params.addToDefinition.layers = requestOptions.layers;
    }
    if (requestOptions.tables && requestOptions.tables.length > 0) {
        requestOptions.params.addToDefinition.tables = requestOptions.tables;
    }
    return arcgisRestRequest.request(adminUrl, requestOptions);
}

exports.createFeatureService = createFeatureService;
exports.addToServiceDefinition = addToServiceDefinition;

Object.defineProperty(exports, '__esModule', { value: true });

})));
//# sourceMappingURL=feature-service-admin.umd.js.map
